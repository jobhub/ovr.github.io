После запуска русского чата на [gitter.im](https://gitter.im/phalcon-rus/chat) выяснилось, что большинство людей не понимает, как устроен build phalcon. Почему существует папка build, что такое компиляция из исходного кода (папки ext),
и не знакомы с процессом сборки проекта написанного на си, мы затронем в данной статье. Процесс компиляции си проекта, я попытаюсь осветить полностью что бы убрать всю тень на данный процесс.

## Немного о настройке, препроцессоре, компиляции и линковки проекта.
Для тех кто никогда не писал и не разбирался в си я расскажу из каких этапов состоит процесс сборки проект.

### Настройки
Этот по-настоящему этап присутствует только с большими приложениям и в Phalcon он сведен к минимуму.
Внутри php присутствует утилита для настройки компиляции и называется она phpize а так же есть утилита php-config которая может рассказать нам о всех настройках в php.

Для того что бы настроить компиляцию нашего расширения нужно зайти в папка и исполнить:

```
phpize
```

А теперь нужно сконфигурировать флаги для компилятора и препроцессора

```
./configure CFLAGS="-g3 -O1 -fno-delete-null-pointer-checks -Wall -fvisibility=hidden"
```

### Препроцессор

Препроцессор — это компьютерная программа, принимающая данные на входе и выдающая данные, предназначенные для входа другой программы (например, компилятора). О данных на выходе препроцессора говорят, что они находятся в препроцессированной форме, пригодной для обработки последующими программами (компилятор). Результат и вид обработки зависят от вида препроцессора; так, некоторые препроцессоры могут только выполнить простую текстовую подстановку, другие способны по возможностям сравниться с языками программирования. Наиболее частый случай использования препроцессора — обработка исходного кода перед передачей его на следующий шаг компиляции. Языки программирования C/C++ и система компьютерной вёрстки TeX используют препроцессоры, значительно расширяющие их возможности.
Данные текст я скопировал с википедия но давайте возьмем на пример. Я буду пользоваться компилятором g++

Создадим файл example.cpp с содержанием

```c++
#include <cstdlib>
#include <iostream>

#define MY_TEXT 1

#define SIMPLE_MACROS_FUNCTION(a, b) \
	\
	\

using namespace std;

int main()
{
	cout << MY_TEXT << endl;
	return 1;
}
```

И запустим компилятор с флагом препроцессора

```
g++ -E example.cpp > output
```

А теперь просмотрим файл output
Мы видем что строки вида

```
#include <cstdlib>
#include <iostream>
```

Были заменены на контент данных файлов

В строке с cout, MY_TEXT был заменен на 1.
```
cout << MY_TEXT << endl;
```


### Компиляции и линковка
Компиляция — это процесс преобразования (трансляции) нашего исходного кода компилятором в эквивалентную программу на низкоуровневом языке.
Так как программа состоит из множества файлов то и компилируется они все по раздельности в бинарные файлы с расширениям .o.
После того как программа скомпилировала все файлы, ей необходимо совместить все бинарные файла, а это и называется линковкой.
Так-как для сборки расширения мы используем систему сборки проекто make то нам просто нужно запустить без параметров и дождаться конца выполнения программы.

```
make
```

### Установка
Вот и все наше расширение скомпилировано и осталось его только установить. Благодаря тому что для си проектов используется система сборки make.
Нам лишь осталось просто запустить make с определенным файлом и дождаться конца копирования нашего расширения.

```
make install
```

Вы скажи вроде бы все а нет. Мы забыли самую простую часть нашего пути. Осталось лишь только дать настройку нашему php прописав в ini файл название рассширения.

Пример редактирования файла конфигурации через утилиту nano:

```
nano /etc/conf.d/phalcon.ini
```

И указать само название рассширения

```
exstension=phalcon.so
```

### Что такое build?
Build это сконеретинированные си файлы в один с доп правками под битность системы систему.
Они нужный для более быстрой компиляции и более мощных преобразований на уровни компилятора.
Собираются они через скрипт лежаший в ./build/gen-build.php, обычный за генерацией билдов следит человек из phalcon team (niden, phalcon, sjinks).

### Так в итоге как же скомпилировать dev сборку из исходников в 1 строку?

```
cd ext && phpize && ./configure CFLAGS="-g3 -O1 -fno-delete-null-pointer-checks -Wall -fvisibility=hidden" && make clean && make -B && sudo make install && service php5-fpm restart
```

Ну и все, наверное, что бы хотелось отметить по данной теме. Это статьей я подвожу вас к понятиям компиляции для того что бы в следящей статье поднять тему об опмитизициях и исполнения кода.